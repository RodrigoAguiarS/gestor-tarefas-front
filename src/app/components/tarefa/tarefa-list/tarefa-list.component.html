<div class="container">
  <div class="search-container">
    <h2>Buscar Tarefas</h2>
    <form [formGroup]="filtroForm" (ngSubmit)="buscarTarefa()">
      <input nz-input placeholder="Número" formControlName="id" />
      <input nz-input placeholder="Título" formControlName="titulo" />
      <input nz-input placeholder="Descrição" formControlName="descricao" />
      <nz-select
        nzShowSearch
        nzAllowClear
        nzPlaceHolder="Responsável"
        formControlName="responsavelId"
      >
        <nz-option
          *ngFor="let usuario of usuarios"
          [nzValue]="usuario.id"
          [nzLabel]="usuario.pessoa.nome"
        ></nz-option>
      </nz-select>
      <nz-select
        nzShowSearch
        nzAllowClear
        nzPlaceHolder="Situação"
        formControlName="situacao"
      >
        <nz-option
          *ngFor="let situacao of situacoes"
          [nzValue]="situacao"
          [nzLabel]="situacao"
        ></nz-option>
      </nz-select>
      <button nz-button nzType="primary" type="submit">
        <i nz-icon nzType="search"></i> Buscar
      </button>
    </form>
  </div>
  <h2>Lista de Tarefas</h2>
  <nz-table
    #basicTable
    [nzData]="tarefas"
    [nzPageSize]="itensPorPagina"
    [nzFrontPagination]="false"
    [nzPageIndex]="paginaAtual"
    [nzLoading]="carregando"
    [nzBordered]="true"
    [nzTotal]="totalElementos"
    (nzPageIndexChange)="aoMudarPagina($event)"
  >
    <thead>
      <tr>
        <th scope="col">Número</th>
        <th scope="col">Título</th>
        <th scope="col">Descrição</th>
        <th scope="col">Responsável</th>
        <th scope="col">Situação</th>
        <th scope="col">Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let tarefa of tarefas">
        <td>{{ tarefa.id }}</td>
        <td>{{ tarefa.titulo }}</td>
        <td>{{ tarefa.descricao }}</td>
        <td>{{ tarefa.responsavel.pessoa.nome }}</td>
        <td>{{ tarefa.situacao }}</td>
        <td>
          <a [routerLink]="['/tarefas/update', tarefa.id]">
            <i
              nz-icon
              nzType="edit"
              nzTheme="outline"
              title="Atualizar tarefa"
            ></i>
          </a>
          <a [routerLink]="['/tarefas/delete', tarefa.id]">
            <i
              nz-icon
              nzType="delete"
              nzTheme="outline"
              title="Deletar tarefa"
            ></i>
          </a>
          <a
            nz-popconfirm
            nzPopconfirmTitle="Tem certeza que deseja concluir esta tarefa?"
            (nzOnConfirm)="confirm(tarefa.id)"
            (nzOnCancel)="cancel()"
          >
            <i
              nz-icon
              nzType="check-circle"
              nzTheme="outline"
              title="Concluir tarefa"
            ></i>
          </a>
          <a
            nz-popconfirm
            nzPopconfirmTitle="Tem certeza que deseja exportar esta tarefa para PDF?"
            (nzOnConfirm)="exportarTarefaParaPDF(tarefa)"
            (nzOnCancel)="cancel()"
          >
            <i
              nz-icon
              nzType="file-pdf"
              nzTheme="outline"
              title="Exportar para PDF"
            ></i>
          </a>
        </td>
      </tr>
    </tbody>
  </nz-table>
</div>
