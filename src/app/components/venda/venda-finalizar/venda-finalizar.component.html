<div class="venda-container">
  <nz-card>
    <ng-container *ngIf="!pedidoRealizado">
      <!-- Header com total -->
      <div class="header-total">
        <h2>Total a Pagar</h2>
        <div class="valor-total">{{ valorTotal | currency : "BRL" }}</div>
      </div>

      <form [formGroup]="vendaForm" (ngSubmit)="finalizarVenda()">
        <!-- Lista de Produtos -->
        <section class="produtos-section">
          <h3><i nz-icon nzType="shopping-cart"></i> Seus Produtos</h3>
          <div class="produtos-lista">
            <ng-container *ngIf="itensCarrinho.length > 0">
              <div class="produto-card" *ngFor="let item of itensCarrinho">
                <div class="produto-info">
                  <span class="nome">{{ item.produto.nome }}</span>
                  <span class="preco">{{
                    item.produto.preco | currency : "BRL"
                  }}</span>
                </div>

                <div class="quantidade-controle">
                  <button
                    nz-button
                    nzShape="circle"
                    (click)="diminuirQuantidade(item.produto)"
                  >
                    <i nz-icon type="button" nzType="minus"></i>
                  </button>
                  <span class="quantidade">{{ item.quantidade }}</span>
                  <button
                    nz-button
                    nzShape="circle"
                    type="button"
                    (click)="aumentarQuantidade(item.produto)"
                  >
                    <i nz-icon nzType="plus"></i>
                  </button>
                  <button
                    nz-button
                    type="menu"
                    class="btn-remover"
                    type="button"
                    (click)="removerItem(item.produto.id)"
                  >
                    <i nz-icon nzType="delete"></i>
                  </button>
                </div>
              </div>
            </ng-container>
          </div>
        </section>

        <!-- Endereço -->
        <section class="endereco-section" *ngIf="cliente">
          <h3><i nz-icon nzType="environment"></i> Endereço de Entrega</h3>
          <div class="endereco-card">
            <div class="endereco-principal">
              {{ cliente.rua }}, {{ cliente.numero }}
            </div>
            <div class="endereco-complemento">
              {{ cliente.bairro }} - {{ cliente.cidade }}/{{ cliente.estado }}
            </div>
            <div class="endereco-cep">CEP: {{ cliente.cep }}</div>
          </div>
        </section>

        <!-- Pagamento -->
        <section class="pagamento-section">
          <h3><i nz-icon nzType="credit-card"></i> Forma de Pagamento</h3>
          <nz-select formControlName="pagamento" nzBlock>
            <nz-option
              *ngFor="let pag of pagamentos"
              [nzValue]="pag"
              [nzLabel]="pag.nome"
            >
            </nz-option>
          </nz-select>
        </section>

        <!-- Resumo -->
        <section class="resumo-section">
          <div class="resumo-item">
            <span>Subtotal</span>
            <span>{{ valorParcial | currency : "BRL" }}</span>
          </div>
          <div class="resumo-item" *ngIf="acrescimo > 0">
            <span>Acréscimo</span>
            <span>{{ acrescimo }}%</span>
          </div>
          <div class="resumo-item total">
            <span>Total</span>
            <span>{{ valorTotal | currency : "BRL" }}</span>
          </div>
        </section>

        <!-- Botão Finalizar -->
        <button
          nz-button
          nzType="primary"
          nzSize="large"
          [nzLoading]="carregando"
          [disabled]="carregando || !vendaForm.valid"
          type="submit"
          class="btn-finalizar"
        >
          Finalizar Compra
        </button>
      </form>
    </ng-container>
  </nz-card>
</div>
